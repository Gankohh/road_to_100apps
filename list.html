<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>100本チャレンジ 一覧</title>
  <style>
    :root{ --color-primary:#22c55e; --color-bg:#0b0b0c; --color-card:#16171a; --color-text:#f5f7fa; --radius:16px; }
    body{margin:0;background:var(--color-bg);color:var(--color-text);font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto}
    .wrap{max-width:860px;margin:32px auto;padding:0 16px}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px}
    a{color:#9acbff}
    .card{background:var(--color-card);border:1px solid #24262b;border-radius:var(--radius);padding:20px}
    .tools{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0}
    input{width:100%;max-width:320px;padding:10px;border-radius:10px;border:1px solid #2a2d32;background:#0f1012;color:#fff}
    table{width:100%;border-collapse:separate;border-spacing:0 8px}
    th,td{padding:12px}
    tr{background:#141518;border:1px solid #24262b}
    tr td:first-child, tr th:first-child{border-top-left-radius:12px;border-bottom-left-radius:12px}
    tr td:last-child, tr th:last-child{border-top-right-radius:12px;border-bottom-right-radius:12px}
    .btn{cursor:pointer;border:0;border-radius:999px;padding:8px 12px;background:#2a2f35;color:#cbd5e1}
    .btn.del{background:#3a1f22;color:#ffdfe3}
    .badge{background:#233126;color:#a7f3d0;border:1px solid #2f4b3a;border-radius:999px;padding:2px 8px;font-size:12px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1 style="margin:0;font-size:20px">100本チャレンジ 一覧</h1>
      <a href="index.html">← カウンターへ戻る</a>
    </header>

    <div class="card" style="margin-top:12px">
      <div class="tools">
        <input id="q" placeholder="検索（名前に含まれる文字）" />
        <button class="btn" id="sortNew">新しい順</button>
        <button class="btn" id="sortOld">古い順</button>
      </div>

      <table id="tbl">
        <thead>
          <tr>
            <th style="text-align:left">#</th>
            <th style="text-align:left">アプリ名</th>
            <th style="text-align:left">URL</th>
            <th style="text-align:left">登録日時</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <p id="empty" style="opacity:.8">まだ登録がありません。</p>
    </div>
  </div>

  <script src="app.js"></script>
  <script>
    const q = document.getElementById('q');
    const tbody = document.querySelector('#tbl tbody');
    const empty = document.getElementById('empty');
    let sort = 'new';

    function draw(){
      const list = AppStore.list();
      const query = (q.value||'').toLowerCase();
      let rows = list.filter(x => x.name.toLowerCase().includes(query));
      rows = [...rows].sort((a,b)=> sort==='new' ? (b.createdAt - a.createdAt) : (a.createdAt - b.createdAt));
      tbody.innerHTML = '';
      rows.forEach((item, idx)=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${idx+1}</td>
          <td>${escapeHtml(item.name)}</td>
          <td>${item.url ? `<a href="${escapeAttr(item.url)}" target="_blank" rel="noopener">リンク</a>` : '<span class="badge">URLなし</span>'}</td>
          <td>${new Date(item.createdAt).toLocaleString()}</td>
          <td><button class="btn del" data-id="${item.id}">削除</button></td>
        `;
        tbody.appendChild(tr);
      });
      empty.style.display = rows.length ? 'none' : 'block';
    }
    q.oninput = draw;
    document.getElementById('sortNew').onclick = ()=>{sort='new'; draw();}
    document.getElementById('sortOld').onclick = ()=>{sort='old'; draw();}
    tbody.addEventListener('click', (e)=>{
      const btn = e.target.closest('button.del');
      if (!btn) return;
      const id = btn.getAttribute('data-id');
      if (confirm('削除しますか？')) { AppStore.remove(id); draw(); }
    });
    function escapeHtml(s){return s.replace(/[&<>"'`=\/]/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;', "'":'&#39;','/':'&#x2F;','`':'&#x60;','=':'&#x3D;' }[c]))}
    function escapeAttr(s){return s.replace(/"/g,'&quot;')}
    draw();
  </script>
</body>
</html>
